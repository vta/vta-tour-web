<dom-module id="training-quiz">
    <template>
      <style is="custom-style" include="shared-styles"></style>
      <style>
        paper-dropdown-menu {
          width: 100%;
        }

        .route-selection-message {
          color: var(--secondary-color);
          margin-left: 26%;
          margin-top: 1%;
        }

        paper-fab{
          float: left;
          position: relative;
          margin-left: 44%;
          margin-top: 10px;
          width:135px;
          background-color: #02528a;
          border-radius: 29px;
          touch-action: manipulation;
          -ms-touch-action: manipulation;
          cursor: pointer;
          font-weight: 600;
          text-align: center;
          height: 45px;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
          background-image: none;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(2, 82, 138, 0.19);
        }
        .panel-body {
          padding: 10px!important;
          border-radius: 10px!important;
          background-color: #FFF!important;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(2, 82, 138, 0.19);
          margin-top: 16px;
          width: 86%;
          margin-left: 14%!important;
        }
        paper-input-autocomplete,paper-dropdown-menu{
          border: 1px solid #02528a!important;
          box-shadow: none;
          /* color: #c2c2c2; */
          padding: 1px 32px;
          font-size: 11px;
          border-radius: 60px!important;
        }
        paper-material{
          width:88%;
        }
        /* paper-dropdown-menu{
          padding: 5px!important;
          border-radius: 21px!important;
          background-color: #FFF!important;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(2, 82, 138, 0.19) !important;
          margin-top: 16px;
          border: 1px solid #02528a!important;
          height: 60px;
        } */
        @media all and (min-width: 768px) and (max-width: 980px) {
          .panel-body {
            width: 85%;
            margin-left: 10%;
          }
          .route-selection-message {
            margin-left: 20%;
          }
        }
        @media all and (max-width: 768px) {
          .panel-body {
            width: 85%;
            margin-left: 10%;
          }
          .top-header{
            height: 39px!important;
          }

          paper-fab{
            margin-left: 40%;
            margin-top: 30px;
          }
          .route-selection-message {
            margin-left: 15%;
          }
          .quiz-area {
            padding-left: 5%!important;
            padding-right: 5%!important;
        }


        }

        @media (max-width: 480px) {
          .panel-body {
            width: 100%;
            margin-left: 0%;
          }
          .top-header{
            height: 39px!important;
          }
            paper-fab{
              margin-left: 38%;
              margin-top: 30px;
            }
            .route-selection-message {
              margin-left: 10%;
            }

        }
        @media (max-width:320px) {

              .panel-body {
                width: 100%;
                margin-left: 0%;
              }

        }
        .header-frontend .navbar{
              min-height: 52px !important;
        }
        .dataTables_info {
            color: #fff!important;
            margin-top: 38px!important;
        }


        .f-box i {
            font-size: 25px;
            line-height: normal;
            margin-top: 27px;
            display: block;
            color: #fff;
        }

        .dataTables_info {
            color: #fff!important;
            margin-top: 8px;
        }

        .f-box {

            height: 104px!important;

        }
        @media (max-width: 768px){

        	.top-header .header-item {

             margin-left:0px!important;
        ;
            /* padding-top: 4px; */
        }
        .top-header {

            height:36px!important;
            padding-left: 15px;
            padding-right: 15px;
        }
      }

      .training-quiz h3{ font-size:21px !important; color:#02528a!important; font-weight: 345}
      .training-quiz{ padding-bottom:1px;}
      .background-color,.background-color .training-quiz{
        padding-bottom:0px;
      }
      .quiz-area{ padding-left:1%!important; padding-right:10%!important; }
      .quiz2{ line-height:33px!important;}
      .inner-content{
        padding-bottom: 1px !important;
        margin: 2px 0px !important;
      }
      .training-quiz.training-quiz h3.training-quiz{
            padding-top: 20px;
      }
      .f-box{
        cursor: pointer;
      }
      #saveOperationResultModal {
        width: auto;
        background-color: transparent;
        color: var(--vta-white);
        box-shadow: none;
      }

      #saveOperationResultModal .icon {
        text-align: center;
      }

      #saveOperationResultModal iron-icon {
        width: 140px;
        height: 140px;
        padding: 20px;
        text-align: center;
        -webkit-border-radius: 50%;
        border-radius: 50%;
      }

      #saveOperationResultModal .message-wrapper.success iron-icon {
        background-color: var(--primary-color);
      }

      #saveOperationResultModal .message-wrapper.error iron-icon {
        background-color: var(--secondary-color);
      }

      #saveOperationResultModal .message {
        text-align: center;
        font-size: 2.5em;
        line-height: 1;
        text-transform: none;
        font-weight: bold;
        margin-top: 10px;
      }
      .special-messge{
        padding: 2px!important;
        border-radius: 10px!important;
        background-color: #FFF!important;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(2, 82, 138, 0.19);
        margin-top: 10px;
        width: 61%;
        margin-left: 20%!important;
        text-align: center;
      }

      .banner{
        height: auto;
        position: relative;
        overflow: auto;
        margin-bottom: 0.5%;
      }
      /*  Extra Media queries */

      @media all and (min-width: 768px) and (max-width: 980px) {

      }
      @media all and (max-width: 768px) {

        }
      @media (max-width: 480px) {
            .panel-body{
              margin-left: 5%!important;
            }
            .training-quiz h3{
              font-size: 15px !important;
            }
            .quiz2{
                  line-height: 20px!important;
            }

            .f-box{
              padding:0px!important;
              padding-top:5%!important;
              height: 60px!important;
              margin-top: 10px !important;
            }
            .f-box i {
                margin-top: 10px !important;
            }
            .f-box h2{
              font-size: 10px!important;
            }
            .dataTables_info{
                  margin-top: 15px!important;
            }
        }
        .background-color{
          /* margin-top: 7%; */
          position: fixed;
          bottom: 0;
        }
        google-map {
          height: 300px;
        }
        /* (1600x900) HD+ Display */
        @media  screen and (max-width: 2560px) and (min-width: 1600px){
            /* insert styles here */
            .container{
              min-width:1600px;
              width:100%;
            }
            .panel-body{
              height:650px;
            }
            .quiz_content{
              /* margin-top: 10%; */
            }
            .training-quiz h3{
              font-size: 30px !important;
            }
            .quiz2{
                  line-height: 60px!important;
                  font-size: 18px;
            }
            google-map,.map_wrapper{
              height: 600px !important;
            }
            .dataTables_info{
              font-size: 18px;
            }
        }
      </style>
      <firebase-document
        app-name="vta"
        id="routeDataProcessing">
      </firebase-document>
      <div class="top-header">
              <div class="container-fluid header-area">
                  <div class="pull-left">

                      <div style="height:30px;" class="header-item">Training</div>

                  </div>
                  <div class="pull-right  ">


                  </div>
                  <!-- #top-social end -->

              </div>

      </div>

      <div class="inner-content">


        <template is="dom-if" if="[[!_startPrepareingQA]]">
            <div class="" style="text-align: center;margin-top: 5%;">
              <div class="add-stop-wrapper">
              <paper-button on-click="_startPrepareingQuizQA" toggles raised class="green" style="width: 175px;
    height: 45px;
    font-size: 20px;
    padding: 0px;background-color:#0B5388" >
                <iron-icon icon="icons:chevron-right" ></iron-icon> Start Quiz
              </paper-button>
             </div>
            </div>
        </template>

    <template is="dom-if" if="[[_startPrepareingQA]]">
        <template is="dom-if" if="[[!_qa.length]]">
          <div class="special-messge">
            <h3>Preparing Training Q&A Please wait.....<iron-icon icon="icons:hourglass-empty"></iron-icon></h3>
          </div>
        </template>
    </template>


        <template is="dom-if" if="[[_allQuestionAnswered]]">
          <div class="special-messge">
            <h3>Thanks for completing quiz, you can review your answers below or go to main screen and continue exploring different routes</h3>
          </div>
        </template>

        <div class="quiz_content" hidden$="{{!_qa.length}}">
          <section class="banner">
          <div class="container quiz-area">
          	<div class="panel-body style-scope training-quiz">
            <div class="col-md-6 col-xs-12 map_wrapper">
              <route-map id="routeMap" geo-points="{{_currentQA.geoPoints}}"></route-map>
            </div>
            <div class="col-md-6 col-xs-12 question_wrapper">
                    <div class="style-scope training-quiz">
                      <h3 class="style-scope training-quiz">Q[[_getQuestionNumber(_currentQAIndex)]]: [[_currentQA.questionText]]</h3>
                      <div class="style-scope training-quiz">
                        <template is="dom-repeat" items="[[_currentQA.options]]" as="optionItem" >
                          <span class="style-scope training-quiz quiz2">
                              <input id="answer_option_[[index]]" name="optionAnswer" type="radio" value="[[index]]" class="optionAnswer clearAbleCheck"/> [[optionItem.name]]
                          <template is="dom-if" class="style-scope training-quiz"></template>
                          </span>
                          <br class="style-scope training-quiz">
                        </template>
                      </div>
                      </div>
                </div>
              <div class="clearfix"></div>
            </div>
           </div>
         </section>

         <div id="spacer_div" clss="spacer_div"><br/></div>
         <div id="spacer_div_2" clss="spacer_div"><br/></div>
         <div id="spacer_div_3" clss="spacer_div"><br/></div>
         <div id="spacer_div_4" clss="spacer_div"><br/></div>
         <br/>


            <!--container start-->
            <div class="background-color">
            <div class="container">
                <div class="row">
                    <!--feature start-->
                    <div class="button-area">
                    <div class="col-lg-4 col-sm-4 col-xs-4 icon">
                        <section>
                            <div class="f-box" on-click="_showPreviousAnswer">
                                <i><img style=" width:30px;" src="../../images/back02.svg" alt=""></i>

                            </div>

                        </section>
                    </div>
                    <div class="col-lg-4 col-sm-4 col-xs-4 icon">
                        <section>
                            <div class="f-box">
                              <div class="dataTables_info" id="sample_1_info">Showing [[_getQuestionNumber(_currentQAIndex)]] of [[_qa.length]] entries</div>
                            </div>

                        </section>
                    </div>
                    <div style=" border-right:1px solid #fff" class="col-lg-4 col-sm-4 col-xs-4 icon" >
                        <section>
                            <div class="f-box" on-click="_checkAnswer">
                                 <i><img style=" width:30px;" src="../../images/right-arrow.svg" alt=""></i>

                            </div>

                        </section>
                    </div>
                    </div>
                    <!--feature end-->
                </div>

            </div>
          </div>

        </div>

      </div>

      <paper-dialog id="saveOperationResultModal" modal>
        <template is="dom-if" if="{{_operationSuccess}}">
          <div class="message-wrapper success">
            <div class="icon">
              <iron-icon icon="icons:check"></iron-icon>
            </div>
            <div class="message">{{_operationMessageDetail}}</div>
          </div>
        </template>
        <template is="dom-if" if="{{!_operationSuccess}}">
          <div class="message-wrapper success">
            <div class="icon">
              <iron-icon icon="icons:close"></iron-icon>
            </div>
            <div class="message">{{_operationMessageDetail}}</div>
          </div>
        </template>
      </paper-dialog>
      <maps-utils id="mapsUtils"></maps-utils>
    </template>

</dom-module>

<script>
	(function() {
    'use strict';
    Polymer({
      is: 'training-quiz',

      properties: {
        _qa: {
          type: Array,
          value: []
        },
        _currentQA:{
            type: Object,
        },
        _currentQAIndex:{
            type: Number,
        },
        _allQuestionAnswered:{
          type: Boolean,
        },
        _startPrepareingQA:{
            type: Boolean,
            value:false
        }
      },

      _generateQASet:function(processedRoutes){
        var qa = [];
        var existingRouteListRelatedQuestion = 0;
        var existingDirectionRelatedQuestion = 0;
        var existingStopPositionRelatedQuestion = 0;
        var shuffleArray = function (array) {
              for (var i = array.length - 1; i > 0; i--) {
                  var j = Math.floor(Math.random() * (i + 1));
                  var temp = array[i];
                  array[i] = array[j];
                  array[j] = temp;
              }
              return array;
          }

        var generateUniqueRandom = function(n,range){
            var arr = []
            while(arr.length < n){
                var randomnumber = Math.floor(Math.random()*range) + 1;
                if(arr.indexOf(randomnumber) > -1) continue;
                arr[arr.length] = randomnumber;
            }
            return arr;
        }
        for(var index in  processedRoutes){

         if(qa.length<10){
           var tempQuizItem = {};
           var tempRoute = processedRoutes[index];
           var direction = Math.random() < 0.5 ? 'a' : 'b';
           var questionType =  Math.floor(Math.random() * 2) + 1;
           var directionName = "";
           if(direction=='a'){
             directionName = tempRoute.directionAName;
           }else{
             directionName = tempRoute.directionBName;
           }
           var question = ""
           var answer = null;
           var options = [];
           for(var i=0;i<qa.length;i++){
             if(qa[i].quesrtionType=='stop_position_related'){
               existingStopPositionRelatedQuestion ++;
             }
             if(qa[i].quesrtionType=='route_list_related'){
               existingRouteListRelatedQuestion ++;
             }
           }

           if(existingRouteListRelatedQuestion>=4){
             if(questionType<=1){
               var randomStopSelection = Math.floor(Math.random() * (tempRoute.routeDetails[direction].stops.length - 2)) + 1;
               if(randomStopSelection>=tempRoute.routeDetails[direction].stops.length){
                 randomStopSelection = randomStopSelection -1;
               }
               question = "What is the next stop after "+tempRoute.routeDetails[direction].stops[randomStopSelection].name+" on "+ tempRoute.name + " "+directionName + " bound";

               answer = randomStopSelection +1;
               var answerStop = tempRoute.routeDetails[direction].stops[answer];
               answerStop.isCorrect = true;
               options.push(answerStop);
               var arr = [answer];
               var length = tempRoute.routeDetails[direction].stops.length >4?4:tempRoute.routeDetails[direction].stops.length;
               while(arr.length < length){
                   var randomnumber = Math.floor(Math.random()*tempRoute.routeDetails[direction].stops.length) + 1;
                   if(arr.indexOf(randomnumber) > -1 && randomnumber !=randomStopSelection) continue;
                   if(tempRoute.routeDetails[direction].stops[randomnumber] && tempRoute.routeDetails[direction].stops[randomnumber].name !=answerStop.name){
                     arr[arr.length] = randomnumber;
                     options.push(tempRoute.routeDetails[direction].stops[randomnumber]);
                   }
               }

             }else{
               var randomStopSelection = Math.floor(Math.random() * (tempRoute.routeDetails[direction].stops.length - 1)) + 1;
               question = "What is the stop before "+tempRoute.routeDetails[direction].stops[randomStopSelection].name+" on "+ tempRoute.name + " "+directionName + " bound";
               answer = randomStopSelection -1;
               var answerStop = tempRoute.routeDetails[direction].stops[answer];
               answerStop.isCorrect = true;
               options.push(answerStop);
               var arr = [answer];
               var length = tempRoute.routeDetails[direction].stops.length >4?4:tempRoute.routeDetails[direction].stops.length;
               while(arr.length < length){
                   var randomnumber = Math.floor(Math.random()*tempRoute.routeDetails[direction].stops.length) + 1;
                   if(arr.indexOf(randomnumber) > -1 && randomnumber !=randomStopSelection) continue;
                   if(tempRoute.routeDetails[direction].stops[randomnumber] && tempRoute.routeDetails[direction].stops[randomnumber].name !=answerStop.name){
                     arr[arr.length] = randomnumber;
                     options.push(tempRoute.routeDetails[direction].stops[randomnumber]);
                   }
               }
             }
             var questionAnswerObject = {
               questionText:question,
               //answerIndex : answer,
               options:shuffleArray(options),
               //mainRoute:tempRoute,
               direction:direction,
               quesrtionType:'stop_position_related',
               lat:answerStop.lat,
               lng:answerStop.lng,
               geoPoints:tempRoute.routeDetails[direction].videoGeoPoints
             }
             qa.push(questionAnswerObject);
           }else{
             //existingRouteListRelatedQuestion++;
             var tempStops = tempRoute.routeDetails[direction].stops;
             var tempStopsThatHasRouteConnection = [];
             for(var i=0;i<tempStops.length;i++){
               if(tempStops[i].route_list){
                 var connectsArray = tempStops[i].route_list.split(',');
                 if(connectsArray.length>=2){
                   tempStopsThatHasRouteConnection.push(tempStops[i])
                 }
               }
             }

             if(tempStopsThatHasRouteConnection.length){
               var randomStopSelection = Math.floor(Math.random() * (tempStopsThatHasRouteConnection.length));
               var randomlySelectedStop = tempStopsThatHasRouteConnection[randomStopSelection];
               question = "Which routes is connected by stop "+randomlySelectedStop.name+" on "+ tempRoute.name + " "+directionName + " bound";
               var correctAnswer = {
                 name:randomlySelectedStop.name+' connects route '+randomlySelectedStop.route_list,
                 isCorrect:true
               }
               var actualAnswerArray = randomlySelectedStop.route_list.split(',')
               options.push(correctAnswer);
               var wrongOption1 = generateUniqueRandom(actualAnswerArray,1000)
               var wrongAnswer1 = {
                 name:randomlySelectedStop.name+' connects route '+generateUniqueRandom(actualAnswerArray.length,1000)
               }
               options.push(wrongAnswer1);

               var wrongAnswer2 = {
                 name:randomlySelectedStop.name+' connects route '+generateUniqueRandom(actualAnswerArray.length,1000)
               }
               options.push(wrongAnswer2);
               var wrongAnswer3 = {
                 name:randomlySelectedStop.name+' connects route '+generateUniqueRandom(actualAnswerArray.length,1000)
               }
               options.push(wrongAnswer3);
               var questionAnswerObject = {
                 questionText:question,
                 //answerIndex : answer,
                 options:shuffleArray(options),
                 //mainRoute:tempRoute,
                 direction:direction,
                 quesrtionType:'route_list_related',
                 lat:randomlySelectedStop.lat,
                 lng:randomlySelectedStop.lng,
                 geoPoints:tempRoute.routeDetails[direction].videoGeoPoints
               }
               qa.push(questionAnswerObject);
             }
           }
          }

        }

        this._qa = shuffleArray(qa);
        this._currentQAIndex = 0;
        this._currentQA = this._qa[this._currentQAIndex];
        this._setMapFocus();

        var self = this;
        setInterval(function(){
          var mapWapperHeight = $('.map_wrapper').height();
          var questionWrapperHeight = $('.question_wrapper').height();
          var mapHeight = mapWapperHeight>questionWrapperHeight && screen.width>1000? mapWapperHeight:questionWrapperHeight;
          $('.map_wrapper').height(mapHeight);
          if(self.$.routeMap){
            self.$.routeMap._adjustMapSize(mapHeight);
          }
        }, 2000);
      },
      _combineRouteAndRouteDetails: function(routes,routeDetailses){
        var finalRoutes = [];
        for (var routeKey in routes) {
          var tempRoute = routes[routeKey]
              if(tempRoute){
                if(routeDetailses && routeDetailses[routeKey] && routeDetailses[routeKey].a && routeDetailses[routeKey].a.stops && routeDetailses[routeKey].b && routeDetailses[routeKey].b.stops){
                  tempRoute.routeDetails = routeDetailses[routeKey];
                  finalRoutes.push(tempRoute);
                }
              }
        }
        var arr = [];
        var ranDomRoutes = [];
        while(arr.length < 20){
            var randomnumber = Math.floor(Math.random()*finalRoutes.length) + 1;
            if(arr.indexOf(randomnumber) > -1) continue;
            if(finalRoutes[randomnumber]){
              arr[arr.length] = randomnumber;
              ranDomRoutes.push(finalRoutes[randomnumber]);
            }
        }
        this._generateQASet(ranDomRoutes);
      },
      _getQuestionNumber : function(index){
         return parseInt(index)+1;
      },
      _startPrepareingQuizQA:function(){
        this._startPrepareingQA = true;
        this._allQuestionAnswered = false;
        var self = this;
        var routes = [];
        var routesDetailses = [];
         this.$.routeDataProcessing.getStoredValue('/routes')
           .then(function(data) {
             routes = data;
             var finalRoutes = [];
             for (var routeKey in routes) {
               var tempRoute = routes[routeKey]
                   if(tempRoute){
                     finalRoutes.push(tempRoute);
                   }
             }
             var arr = [];
             var ranDomRoutes = [];
             while(arr.length < 20){
                 var randomnumber = Math.floor(Math.random()*finalRoutes.length) + 1;
                 if(arr.indexOf(randomnumber) > -1) continue;
                 if(finalRoutes[randomnumber]){
                   arr[arr.length] = randomnumber;
                   ranDomRoutes.push(finalRoutes[randomnumber]);
                 }
             }

             var finalSuitbleRoutes = [];


             var startMerge =  function(index){
               if(index<ranDomRoutes.length && finalSuitbleRoutes.length<10){
                 var fullRouteDetails = {};
                 fullRouteDetails = ranDomRoutes[index];
                 self.$.routeDataProcessing.getStoredValue('/route-details/'+fullRouteDetails.code)
                   .then(function(routeDetailsData) {
                    if(routeDetailsData && ((routeDetailsData.a && routeDetailsData.a.stops) || (routeDetailsData.b && routeDetailsData.b.stops))){
                      fullRouteDetails.routeDetails = routeDetailsData;
                      finalSuitbleRoutes.push(fullRouteDetails);
                    }
                    startMerge(index+1);
                   }).catch(function(error) {
                     console.log(error);
                   });
               }else{
                 self._generateQASet(finalSuitbleRoutes);
               }
             }
             startMerge(0);

             //return false;
           }).catch(function(error) {
             console.log(error);
           });
      },
      ready: function() {

      },
      _showOperationResultModal: function(isSuccess, operationDetailMessage) {
        this.$.saveOperationResultModal.open();
        var self = this;
        this._operationSuccess = isSuccess;
        this._operationMessageDetail = operationDetailMessage;
      },
      _closeOperationResultModal: function() {
        this.$.saveOperationResultModal.close();
      },
      _showPreviousAnswer:function(e){
        if(this._currentQAIndex<=0){
          return false;
        }{
          this._currentQAIndex -= 1;
        }

        this._currentQA = this._qa[this._currentQAIndex];
        this._setMapFocus();
        for(var i=0;i<this._currentQA.options.length;i++){
          if(this._currentQA.options[i].isCorrect==true){
              $('#answer_option_'+i).prop('checked', true);
          }
        }
      },
      _checkAnswer:function(e){
        var self = this;
        var answer = $("input:radio.optionAnswer:checked");
        if(!answer.length){
          this.$.saveOperationResultModal.close();
          this._showOperationResultModal(false,"Please select an answer");
          setTimeout(function(){
             self.$.saveOperationResultModal.close();
          }, 1000);
        }
        var answerIndex = answer.val();
        if(this._currentQA.options[answerIndex]){
          if(this._currentQA.options[answerIndex] && this._currentQA.options[answerIndex].isCorrect===true){
              this._currentQAIndex += 1;
            if(!this._currentQA.alreadyAnswered){
              this._qa[this._currentQAIndex-1].alreadyAnswered = true;
              if(this._currentQAIndex>=this._qa.length){
                  this._showOperationResultModal(true,"All questions answered");
                  setTimeout(function(){
                     self.$.saveOperationResultModal.close();
                  }, 1000);
                  this._allQuestionAnswered = true;
                  this._currentQAIndex -= 1;
                  return false;
              }
              this._showOperationResultModal(true,"Correct answer, moving to next question");
              setTimeout(function(){
                 self.$.saveOperationResultModal.close();
              }, 1000);
            }
            this._currentQA = this._qa[this._currentQAIndex];
            if(this._currentQA){
                $('.clearAbleCheck').prop('checked', false);
            }else if(this._allQuestionAnswered){
              this._currentQAIndex = this._qa.length - 1;
              this._currentQA = this._qa[this._currentQAIndex];
              this._showOperationResultModal(true,"All questions answered");
              setTimeout(function(){
                 self.$.saveOperationResultModal.close();
              }, 1000);
            }
            this._setMapFocus();
            if(this._currentQA && this._currentQA.alreadyAnswered){
              for(var i=0;i<this._currentQA.options.length;i++){
                if(this._currentQA.options[i].isCorrect==true){
                    $('#answer_option_'+i).prop('checked', true);
                }
              }
            }
          }else{
            this.$.saveOperationResultModal.close();
            this._showOperationResultModal(false,"Wrong answer, Please select the correct answer");
            var self = this;
            setTimeout(function(){
               self.$.saveOperationResultModal.close();
            }, 1000);
          }
        }
      },
      _setMapFocus:function(){
        var lat = this._currentQA.lat;
        var lng = this._currentQA.lng;
        var zoomLevel = 16;
        var self = this;
        if(self.$.routeMap){
          self.$.routeMap._setMapFocusAndZoom(lat,lng,zoomLevel);
          self.$.routeMap._adjustMapSize($('.map_wrapper').height());
        }
      }

    });
  })();
</script>
